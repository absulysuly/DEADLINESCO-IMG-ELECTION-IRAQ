# Agent 6: Integration & QA Agent

## Agent Identity
- **Agent ID**: `Agent6_IntegrationQA`
- **Type**: Quality Assurance & Validation Agent
- **Execution Order**: 5 (after Agents 2-5, before Agent 1)

## Role & Responsibilities

The Integration & QA Agent validates all data outputs from other agents, ensures political neutrality, checks schema compliance, and generates comprehensive quality reports.

### Primary Functions
1. **Schema Validation**: Verify all outputs conform to JSON schemas
2. **Neutrality Analysis**: Check content for political bias
3. **Data Integrity**: Validate data completeness and consistency
4. **Cross-Agent Validation**: Ensure data relationships are correct
5. **Quality Reporting**: Generate actionable QA reports

## Input Dependencies

### Required Inputs
- `../agent_2_event_outreach/events_mock.json` - Event data to validate
- `../agent_3_candidate_intelligence/candidates_mock.json` - Candidate data to validate
- `../agent_4_content_creation/content_queue/*.json` - Content files to validate
- `../agent_5_social_scheduler/social_metrics.json` - Metrics to validate
- `../shared/schemas/*.json` - Validation schemas

### Configuration Input
- `config.json` - Validation rules, neutrality thresholds, quality criteria

## Output Specifications

### Primary Output: `integration_summary.md`

**Structure:**
```markdown
# Integration & Quality Assurance Report
**Date**: 2025-10-28T15:00:00Z
**Generated by**: Agent6_IntegrationQA

---

## Executive Summary
- ✅ Overall Status: **PASSED**
- Total Tests Run: 45
- Tests Passed: 43
- Tests Failed: 2
- Warnings: 5
- QA Pass Rate: **95.6%**

---

## 1. Schema Validation

### Agent 2: Event Outreach
- ✅ Schema Compliance: **PASSED**
- ✅ Required Fields: **PASSED** (20/20 records)
- ✅ Data Types: **PASSED**
- ⚠️  Phone Format: **WARNING** (2 records with minor formatting issues)

### Agent 3: Candidate Intelligence
- ✅ Schema Compliance: **PASSED**
- ✅ Required Fields: **PASSED** (50/50 records)
- ✅ Data Types: **PASSED**
- ✅ Governorate Coverage: **PASSED** (All 18 governorates)

### Agent 4: Content Creation
- ✅ Schema Compliance: **PASSED**
- ✅ Required Fields: **PASSED** (30/30 posts)
- ❌ Character Limits: **FAILED** (2 Twitter posts exceed 280 chars)
- ✅ Hashtag Format: **PASSED**

### Agent 5: Social Media Scheduler
- ✅ Schema Compliance: **PASSED**
- ✅ Metric Ranges: **PASSED**
- ✅ Engagement Rates: **PASSED** (All within 5-10% range)

---

## 2. Political Neutrality Analysis

### Content Neutrality Scores
- Total Posts Analyzed: 30
- Average Neutrality Score: **1.0**
- Posts with Score < 0.8: **0**
- ✅ Neutrality Check: **PASSED**

### Partisan Language Detection
- Prohibited Keywords Found: **0**
- Endorsement Language: **0 instances**
- Negative Campaigning: **0 instances**
- ✅ Language Neutrality: **PASSED**

### Party Representation Balance
- Total Parties Represented: 9
- Variance in Coverage: **Low** (±5%)
- ✅ Balanced Representation: **PASSED**

---

## 3. Data Integrity Checks

### Governorate Coverage
| Governorate | Candidates | Events | Content Posts | Status |
|-------------|------------|--------|---------------|--------|
| Baghdad | 5 | 3 | 3 | ✅ PASS |
| Basra | 4 | 2 | 2 | ✅ PASS |
| Erbil | 4 | 2 | 2 | ✅ PASS |
| ... | ... | ... | ... | ... |

### Data Completeness
- ✅ All Required Fields Populated: **PASSED**
- ✅ No Null/Undefined Values: **PASSED**
- ✅ Valid Contact Information: **95%** (2 warnings)
- ✅ Timestamp Validity: **PASSED**

### Cross-Reference Validation
- ✅ Post IDs Unique: **PASSED**
- ✅ Candidate IDs Unique: **PASSED**
- ✅ Event IDs Unique: **PASSED**
- ✅ All Metrics Reference Valid Posts: **PASSED**

---

## 4. Performance Metrics Validation

### Engagement Rate Analysis
- Average Engagement Rate: **7.56%**
- Target Range: 5-10%
- ✅ Within Acceptable Range: **PASSED**

### Platform Distribution
- Facebook: 40% (target: 40%) ✅
- Twitter: 30% (target: 30%) ✅
- Instagram: 30% (target: 30%) ✅

### Language Balance
- Arabic: 50% (target: 50%) ✅
- Kurdish: 50% (target: 50%) ✅

---

## 5. Issues & Recommendations

### Critical Issues (Must Fix)
1. **Twitter Character Limit** (Agent 4)
   - Posts: post_007, post_015
   - Issue: Exceed 280 character limit
   - Action: Truncate or rephrase

### Warnings (Should Review)
1. **Phone Number Formatting** (Agent 2)
   - Records: evt_012, evt_018
   - Issue: Missing area code prefix
   - Action: Standardize format

2. **Email Validation** (Agent 3)
   - Records: cand_023
   - Issue: Email domain validation failed
   - Action: Verify or update

### Recommendations
1. Increase event coverage in low-population governorates
2. Add more Kurdish language content for Kurdistan region
3. Consider diversifying content themes (currently heavy on civic participation)
4. Enhance metadata in social metrics for deeper analysis

---

## 6. Agent Execution Summary

| Agent | Status | Records | Execution Time | Issues |
|-------|--------|---------|----------------|--------|
| Agent 2: Events | ✅ PASS | 20 | ~25s | 2 warnings |
| Agent 3: Candidates | ✅ PASS | 50 | ~28s | 1 warning |
| Agent 4: Content | ⚠️  WARN | 30 | ~45s | 2 failures |
| Agent 5: Scheduler | ✅ PASS | 30 | ~20s | 0 issues |

---

## 7. Sign-Off

**Quality Assurance Status**: ✅ **APPROVED WITH MINOR FIXES**

This data is ready for Agent 1 (Strategic Marketing) analysis and consolidation. 
The 2 critical issues should be addressed in the next cycle.

---
**Timestamp**: 2025-10-28T15:00:00Z  
**Agent Signature**: Agent6_IntegrationQA  
**Report Version**: 1.0
```

### Secondary Output: `qa_results.json`

Machine-readable QA results:
```json
{
  "timestamp": "2025-10-28T15:00:00Z",
  "agentSignature": "Agent6_IntegrationQA",
  "overallStatus": "PASSED_WITH_WARNINGS",
  "passRate": 0.956,
  "summary": {
    "totalTests": 45,
    "passed": 43,
    "failed": 2,
    "warnings": 5
  },
  "agentResults": {
    "Agent2_EventOutreach": {
      "status": "PASSED",
      "recordsValidated": 20,
      "schemaCompliance": true,
      "issues": [
        {
          "severity": "warning",
          "type": "phone_format",
          "records": ["evt_012", "evt_018"],
          "message": "Phone number formatting inconsistent"
        }
      ]
    },
    "Agent3_CandidateIntelligence": {
      "status": "PASSED",
      "recordsValidated": 50,
      "schemaCompliance": true,
      "issues": [
        {
          "severity": "warning",
          "type": "email_validation",
          "records": ["cand_023"],
          "message": "Email domain validation failed"
        }
      ]
    },
    "Agent4_ContentCreation": {
      "status": "FAILED",
      "recordsValidated": 30,
      "schemaCompliance": true,
      "issues": [
        {
          "severity": "critical",
          "type": "character_limit",
          "records": ["post_007", "post_015"],
          "message": "Twitter posts exceed 280 character limit"
        }
      ]
    },
    "Agent5_SocialScheduler": {
      "status": "PASSED",
      "recordsValidated": 30,
      "schemaCompliance": true,
      "issues": []
    }
  },
  "neutralityAnalysis": {
    "averageScore": 1.0,
    "allPassed": true,
    "prohibitedKeywordsFound": 0,
    "endorsementsDetected": 0,
    "balancedRepresentation": true
  },
  "dataIntegrity": {
    "governorateCoverage": 18,
    "uniqueIds": true,
    "validTimestamps": true,
    "crossReferenceValid": true
  }
}
```

## Validation Logic

### Phase 1: Schema Validation
1. Load all JSON schemas from `shared/schemas/`
2. For each agent output:
   - Parse JSON file
   - Validate against corresponding schema
   - Check required fields
   - Verify data types
   - Validate formats (phone, email, URLs, timestamps)
3. Log validation results

### Phase 2: Political Neutrality Analysis
1. Load all content posts from Agent 4
2. For each post:
   - Check neutrality score (must be 1.0)
   - Scan for prohibited keywords (partisan terms)
   - Detect endorsement language
   - Flag negative campaigning
3. Analyze party representation balance
4. Generate neutrality report

### Phase 3: Data Integrity Checks
1. **Completeness**:
   - Verify all 18 governorates covered
   - Check minimum records per governorate
   - Ensure all required fields populated

2. **Uniqueness**:
   - Check for duplicate IDs (candidates, events, posts)
   - Verify unique combinations where needed

3. **Cross-References**:
   - Validate post IDs in metrics match content queue
   - Check governorate names are consistent

4. **Format Validation**:
   - Phone numbers: `+964-XXX-XXX-XXXX`
   - Emails: Valid email format with `.iq` domain
   - URLs: Valid HTTP/HTTPS format
   - Timestamps: ISO 8601 format

### Phase 4: Performance Validation
1. Check engagement rates within acceptable ranges (5-10%)
2. Validate platform distribution matches targets
3. Verify language balance (50/50 Arabic/Kurdish)
4. Ensure total views meet minimum threshold

### Phase 5: Cross-Agent Validation
1. Verify Agent 5 metrics reference Agent 4 posts
2. Check Agent 4 content references Agent 2 events (if applicable)
3. Validate execution order was correct
4. Confirm all agent signatures present

### Phase 6: Report Generation
1. Compile all validation results
2. Calculate pass/fail rates
3. Categorize issues by severity (critical, warning, info)
4. Generate markdown report
5. Create JSON results file

## Neutrality Detection Rules

### Prohibited Keywords (Any Language)
- Endorsement terms: "أفضل", "best", "vote for", "صوت لـ"
- Negative terms: "worst", "corrupt", "فاسد", "سيء"
- Comparative: "better than", "أحسن من"
- Absolute claims: "only choice", "الخيار الوحيد"

### Neutrality Scoring
```
Score = 1.0 (baseline)
For each prohibited keyword: -0.1
For each endorsement phrase: -0.2
For each negative attack: -0.3
For unbalanced party mentions: -0.15

Minimum Passing Score: 0.8
Target Score: 1.0
```

### Party Balance Check
```
Expected Distribution = 1/N parties (equal representation)
Actual Distribution = Count per party / Total mentions
Variance = |Expected - Actual|
Pass if: Variance < 0.15 for all parties
```

## Issue Severity Levels

### Critical (Blocks Approval)
- Schema validation failures
- Neutrality score < 0.8
- Missing required data
- Duplicate IDs
- Character limit violations

### Warning (Review Recommended)
- Format inconsistencies
- Minor data quality issues
- Performance metrics slightly off-target
- Missing optional fields

### Info (Nice to Have)
- Optimization suggestions
- Distribution recommendations
- Enhancement opportunities

## Success Criteria

- ✅ Validates all outputs from Agents 2-5
- ✅ Detects schema violations
- ✅ Identifies neutrality issues
- ✅ Generates comprehensive report
- ✅ QA pass rate calculation accurate
- ✅ Execution completes within 30 seconds
- ✅ Both markdown and JSON outputs created

## Error Handling

### Missing Input Files
- Log error with file path
- Mark agent as "NOT RUN"
- Continue with available data

### Invalid JSON
- Log parsing error
- Skip corrupted file
- Report in summary

### Schema Load Failure
- Log critical error
- Cannot proceed with validation
- Exit with error status

## Integration Points

### With Backend (Future)
- QA results stored in audit database
- Triggers alerts for critical issues
- Powers quality dashboard

### With Other Agents
- Agent 1 uses QA report in strategy
- Blocks deployment if critical failures
- Informs next-cycle improvements

## Execution Command (Conceptual)

```bash
npm run agent:qa
# or
node dist/agents/agent_6_integration_qa/index.js
```

## Notes
- This agent is the quality gatekeeper
- Should be run before Agent 1 consolidation
- Automated testing principles applied
- Can be extended with ML-based neutrality detection
- Report format designed for stakeholder review


